<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>가로형 자기소개표 생성기</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dom-to-image/2.6.0/dom-to-image.min.js"></script>
    <style>
        /* 태그 관련 스타일 */
        #profileTags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-items: center;
        }
        
        .tag-item {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0 12px;
            height: 28px;
            border-radius: 8px;
            font-size: 14px;
            line-height: 28px;
            text-align: center;
            margin: 2px;
        }

        /* 기본 레이아웃 */
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        /* 프로필 이미지 */
        .profile-image {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 9999px;
        }
        
        /* 배경 이미지 */
        #profileSection {
            position: relative;
            overflow: hidden;
        }
        
        .bg-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
        }
        
        .profile-bg {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .profile-content {
            position: relative;
            z-index: 1;
        }
        
        .has-bg-image {
            border: 1px dashed #e9d5ff;
            background-color: rgba(250, 245, 255, 0.3);
        }
        
        /* 버튼 스타일 - 토글 활성화 색상 변경 */
        .option-btn {
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 32px;
        }
        
        /* 상세 정보 영역 - 간격 조정 */
        .info-grid {
            display: grid;
            grid-template-columns: 5rem 1fr;
            align-items: center;
            gap: 0.25rem;
            line-height: 1.5;
            min-height: 32px;
        }

        .info-label {
            padding-right: 2px;
            white-space: nowrap;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        /* 내용 부분 스타일 추가 */
        .info-grid > div:nth-child(2) {
            line-height: 1.5;
            padding-top: 1px;
        }

        /* 헤더 텍스트 위치 조정 */
        #cardHeader {
            display: flex;
            align-items: center;
            height: 48px;
        }

        /* 반응형 */
        @media (min-width: 768px) {
            #profileCard {
                position: sticky;
                top: 20px;
            }
        }
        
        /* 태그 추가 및 이미지 저장 버튼 색상 변경 */
        .custom-button {
            background-color: #E0B664;
            color: white;
        }
        
        .custom-button:hover {
            background-color: #d5a649;
        }
        
        /* 가로형 프로필 카드 스타일 */
        #horizontalProfileCard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            width: 100%;
        }
        
        /* 좌측 프로필 영역 */
        .profile-left {
            padding: 1rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
        }
        
        /* 우측 정보 영역 */
        .profile-right {
            padding: 1rem;
            display: flex;
            flex-direction: column;
        }
        
        /* 상세 정보 그리드 조정 */
        .details-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
        }
        
        @media (max-width: 768px) {
            #horizontalProfileCard {
                grid-template-columns: 1fr;
            }
            
            .details-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* 폴로우 가이드 텍스트 스타일 */
        .follow-guide {
            font-style: italic;
            color: #666;
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }
        
        /* 지뢰 대응 스타일 */
        .mine-response {
            display: flex;
            justify-content: flex-start;
            align-items: center;
            margin-bottom: 0.5rem;
            height: 32px;
        }
        
        .mine-label {
            font-weight: 500;
            color: #4b5563;
            width: 4rem;
        }
        
        .mine-value {
            color: #111827;
            flex-grow: 1;
        }
        
        .mine-response-value {
            text-align: right;
            color: #666;
            font-size: 0.95rem;
        }
        
        /* 설정 섹션 제목 일관성 */
        .setting-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
            background-color: #f3f4f6;
            padding: 0.5rem;
            border-radius: 0.25rem;
        }
        
        /* 설정 항목 레이블 일관성 */
        .setting-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
        }
        
        /* 설정 항목 컨테이너 일관성 */
        .setting-item {
            margin-bottom: 1rem;
        }


/* 프로필 카드 기본 상태에 CSS 변수 선언 */
#profileCard {
    --text-scale-factor: 1; /* 기본값 1 (100%) */
}

/* 글자 크기 조절 슬라이더의 영향을 받아야 하는 요소들 */
#profileBio,
.info-label,
.info-grid > div:nth-child(2), /* 상세 정보 값 부분 */
.mine-value,
.mine-response-value,
.tag-item,
.profile-right h3, /* 우측 섹션 제목 (상세 정보, 선호 태그) */
#profileFollowGuide /* 팔로우 안내 텍스트 (필요시 추가) */
{
    /* 각 요소의 원래 기본 폰트 크기에 변수를 곱해서 최종 크기 계산 */
    /* 예시: 기본값이 1rem 이었다면 */
    font-size: calc(var(--text-scale-factor, 1) * 1rem);
}

/* 특별히 기본 크기가 다른 요소들은 개별 설정 */
#profileBio { /* text-sm = 0.875rem */
    font-size: calc(var(--text-scale-factor, 1) * 0.875rem);
}
.info-label { /* 원래 0.9rem */
    font-size: calc(var(--text-scale-factor, 1) * 0.9rem);
}
.mine-response-value { /* 원래 0.95rem */
    font-size: calc(var(--text-scale-factor, 1) * 0.95rem);
}
.tag-item { /* 원래 14px */
    font-size: calc(var(--text-scale-factor, 1) * 14px);
}

/* 중요: 박스 자체의 크기나 여백 관련 스타일은 이 변수의 영향을 받지 않도록 함 */
/* 예를 들어 .p-2, .gap-2 등 Tailwind 클래스는 rem 기반이므로 */
/* 카드 자체의 font-size를 바꾸지 않으면 영향을 받지 않음 */

/* info-grid의 라벨 너비(5rem)가 문제될 경우 고정값(px)으로 변경 고려 */
/*
.info-grid {
    grid-template-columns: 80px 1fr; /* 예시: 5rem 대신 고정 px 사용 */
}
*/
.profile-right .grid > div { /* .profile-right 안의 .grid 바로 아래 div들 */
    width: 100%;          /* 부모 요소(grid 컨테이너)의 너비를 100% 사용 */
    box-sizing: border-box; /* 패딩, 테두리가 너비 계산에 포함되도록 함 */
}

    </style>
</head>
<body class="bg-gray-100">
    <div class="container flex flex-col md:flex-row">
        <!-- 설정 패널 -->
        <div class="w-full md:w-1/3 p-4 bg-white border-r border-gray-200 overflow-y-auto">
            <h1 class="text-xl font-bold mb-6">가로형 자기소개표 생성기</h1>
            
<!-- 테마 색상 설정 - 기본적으로 접혀있음 -->
            <div class="mb-6">
                <button
                    class="setting-header"
                    onclick="toggleSection('themeSection')"
                >
                    <span>테마 색상 설정</span>
                    <svg id="themeToggleIcon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="transform transition-transform">
                        <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                </button>

                <div id="themeSection" class="hidden">
                    <!-- 헤더 제목 설정 -->
                    <div class="setting-item">
                        <label class="setting-label">헤더 제목</label>
                        <div class="flex">
                            <input
                                type="text"
                                id="headerTitle"
                                value="AI Chat 자기소개표"
                                placeholder="헤더 제목을 입력하세요"
                                class="flex-grow p-2 border border-gray-300 rounded-l"
                                oninput="updateHeaderTitle(this.value)"
                            >
                            <div class="flex flex-col items-center">
                                <input
                                    type="color"
                                    id="headerTextColor"
                                    value="#8C6717"
                                    class="h-full px-2 py-1 border border-gray-300 rounded-r"
                                    oninput="updateHeaderTextColor(this.value)"
                                >
                            </div>
                        </div>
                    </div>

                    <!-- 색상 선택 설정 -->
                    <div class="grid grid-cols-3 gap-0 mb-4">
                        <div class="flex flex-col items-center">
                            <label class="setting-label text-center">헤더 색상</label>
                            <input type="color" id="headerColor" value="#F7F4CB" class="h-10 w-16">
                        </div>

                        <div class="flex flex-col items-center">
                            <label class="setting-label text-center">태그 배경 색상</label>
                            <input type="color" id="tagColor" value="#EFDAB1" class="h-10 w-16">
                        </div>

                        <div class="flex flex-col items-center">
                            <label class="setting-label text-center">태그 텍스트 색상</label>
                            <input type="color" id="tagTextColor" value="#8C6717" class="h-10 w-16">
                        </div>
                    </div>
                    
                    <div class="setting-item mt-4">
                        <label class="setting-label">전체 텍스트 크기 조절</label>
                        <div class="flex items-center gap-2 mb-2">
                            <input
                                type="range"
                                id="textSizeSlider"
                                min="70"
                                max="130"
                                value="100"
                                class="flex-grow"
                                oninput="updateTextSize(this.value); document.getElementById('textSizeInput').value = this.value + '%';"
                            >
                            <input
                                type="text"
                                id="textSizeInput"
                                value="100%"
                                class="w-16 p-1 border border-gray-300 rounded text-center"
                                onchange="updateTextSizeFromInput(this.value)"
                            >
                        </div>

                        <label class="setting-label">헤더 제목 크기 조절</label>
                        <div class="flex items-center gap-2 mb-2">
                            <input
                                type="range"
                                id="headerSizeSlider"
                                min="70"
                                max="150"
                                value="100"
                                class="flex-grow"
                                oninput="updateHeaderSize(this.value); document.getElementById('headerSizeInput').value = this.value + '%';"
                            >
                            <input
                                type="text"
                                id="headerSizeInput"
                                value="100%"
                                class="w-16 p-1 border border-gray-300 rounded text-center"
                                onchange="updateHeaderSizeFromInput(this.value)"
                            >
                        </div>

                        <label class="setting-label">닉네임/아이디 크기 조절</label>
                        <div class="flex items-center gap-2">
                            <input
                                type="range"
                                id="nicknameSizeSlider"
                                min="70"
                                max="150"
                                value="100"
                                class="flex-grow"
                                oninput="updateNicknameSize(this.value); document.getElementById('nicknameSizeInput').value = this.value + '%';"
                            >
                            <input
                                type="text"
                                id="nicknameSizeInput"
                                value="100%"
                                class="w-16 p-1 border border-gray-300 rounded text-center"
                                onchange="updateNicknameSizeFromInput(this.value)"
                            >
                        </div>
                    </div>
                </div> 
            </div>

            <!-- 이미지 설정 섹션 -->
            <div class="mb-6">
                <button 
                    class="setting-header"
                    onclick="toggleSection('imageSection')"
                >
                    <span>이미지 설정</span>
                    <svg id="imageToggleIcon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="transform transition-transform">
                        <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                </button>
                
                <div id="imageSection" class="hidden">
                    <!-- 프로필 이미지 설정 -->
                    <div class="setting-item p-3 border border-gray-200 rounded">
                        <h3 class="text-md font-medium mb-2">프로필 이미지</h3>
                        <input 
                            type="text" 
                            id="profileImageUrl" 
                            placeholder="이미지 URL을 입력하세요" 
                            class="w-full p-2 border border-gray-300 rounded"
                        >
                    </div>
                    
                    <!-- 배경 이미지 설정 -->
                    <div class="p-3 border border-gray-200 rounded">
                        <h3 class="text-md font-medium mb-2">배경 이미지</h3>
                        <input 
                            type="text" 
                            id="backgroundImageUrl" 
                            placeholder="이미지 URL을 입력하세요" 
                            class="w-full p-2 border border-gray-300 rounded mb-3"
                        >
                        
                        <label class="setting-label">배경 투명도: <span id="opacityValue">50%</span></label>
                        <input 
                            type="range" 
                            id="backgroundOpacity" 
                            min="0" 
                            max="100" 
                            value="50" 
                            class="w-full"
                            oninput="document.getElementById('opacityValue').textContent = this.value + '%'"
                        >
                    </div>
                </div>
            </div>
            
            <!-- 프로필 정보 섹션 -->
            <div class="mb-6">
                <h2 class="setting-header">프로필 정보</h2>
                
                <div class="setting-item">
                    <label class="setting-label">닉네임/아이디</label>
                    <input 
                        type="text" 
                        id="nickname" 
                        placeholder="닉네임 (@아이디)" 
                        class="w-full p-2 border border-gray-300 rounded"
                    >
                </div>
                
                <div class="setting-item">
                    <label class="setting-label">소개</label>
                    <textarea 
                        id="bio" 
                        class="w-full p-2 border border-gray-300 rounded"
                        rows="2"
                        placeholder="자신을 간단히 소개해주세요."
                    ></textarea>
                </div>
            </div>
            
            <!-- 상세 정보 섹션 -->
            <div class="mb-6">
                <button 
                    class="setting-header"
                    onclick="toggleSection('detailSection')"
                >
                    <span>상세 정보</span>
                    <svg id="detailToggleIcon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="transform transition-transform">
                        <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                </button>
                
                <div id="detailSection">
                    <!-- 팔로우 안내 - 수정된 선택 방식 -->
                    <div class="setting-item">
                        <label class="setting-label">팔로우 안내</label>
                        <div class="flex flex-wrap gap-2" id="followOptions">
                            <button 
                                type="button" 
                                class="px-3 py-1 border border-gray-300 rounded text-sm option-btn active" 
                                data-target="followType" 
                                data-value="멘션"
                                onclick="toggleOption(this)"
                            >
                                멘션
                            </button>
                            <button 
                                type="button" 
                                class="px-3 py-1 border border-gray-300 rounded text-sm option-btn active" 
                                data-target="followType" 
                                data-value="마음"
                                onclick="toggleOption(this)"
                            >
                                마음
                            </button>
                            <button 
                                type="button" 
                                class="px-3 py-1 border border-gray-300 rounded text-sm option-btn active" 
                                data-target="followType" 
                                data-value="RT"
                                onclick="toggleOption(this)"
                            >
                                RT
                            </button>
                        </div>
                        <input type="hidden" id="followType" value="멘션,마음,RT">
                    </div>
                    
                    <!-- 연령 선택 -->
                    <div class="setting-item">
                        <label class="setting-label">연령</label>
                        <div class="flex flex-wrap gap-2" id="ageOptions">
                            <button 
                                type="button" 
                                class="px-3 py-1 border border-gray-300 rounded text-sm option-btn active" 
                                data-target="age" 
                                data-value="성인"
                                onclick="toggleSingleOption(this, 'ageOptions')"
                            >
                                성인
                            </button>
                            <button 
                                type="button" 
                                class="px-3 py-1 border border-gray-300 rounded text-sm option-btn" 
                                data-target="age" 
                                data-value="미성년자"
                                onclick="toggleSingleOption(this, 'ageOptions')"
                            >
                                미성년자
                            </button>
                            <button 
                                type="button" 
                                class="px-3 py-1 border border-gray-300 rounded text-sm option-btn" 
                                data-target="age" 
                                data-value="비공개"
                                onclick="toggleSingleOption(this, 'ageOptions')"
                            >
                                비공개
                            </button>
                        </div>
                        <input type="hidden" id="age" value="성인">
                    </div>
                    
                    <!-- 트윗 성향 -->
                    <div class="setting-item">
                        <label class="setting-label">트윗 성향</label>
                        <div class="flex flex-wrap gap-2" id="tweetStyleOptions">
                            <button type="button" class="px-3 py-1 border border-gray-300 rounded text-sm option-btn active" data-target="tweetStyle" data-value="일상" onclick="toggleOption(this)">일상</button>
                            <button type="button" class="px-3 py-1 border border-gray-300 rounded text-sm option-btn active" data-target="tweetStyle" data-value="RT" onclick="toggleOption(this)">RT</button>
                            <button type="button" class="px-3 py-1 border border-gray-300 rounded text-sm option-btn active" data-target="tweetStyle" data-value="타장르언급" onclick="toggleOption(this)">타장르언급</button>
                            <button type="button" class="px-3 py-1 border border-gray-300 rounded text-sm option-btn active" data-target="tweetStyle" data-value="욕설" onclick="toggleOption(this)">욕설</button>
                            <button type="button" class="px-3 py-1 border border-gray-300 rounded text-sm option-btn active" data-target="tweetStyle" data-value="우울" onclick="toggleOption(this)">우울</button>
                            <button type="button" class="px-3 py-1 border border-gray-300 rounded text-sm option-btn active" data-target="tweetStyle" data-value="R18" onclick="toggleOption(this)">R18</button>
                            <button type="button" class="px-3 py-1 border border-gray-300 rounded text-sm option-btn active" data-target="tweetStyle" data-value="폭력성" onclick="toggleOption(this)">폭력성</button>
                            <button type="button" class="px-3 py-1 border border-gray-300 rounded text-sm option-btn active" data-target="tweetStyle" data-value="고어" onclick="toggleOption(this)">고어</button>
                            <button type="button" class="px-3 py-1 border border-gray-300 rounded text-sm option-btn active" data-target="tweetStyle" data-value="탐라대화" onclick="toggleOption(this)">탐라대화</button>
                            <button type="button" class="px-3 py-1 border border-gray-300 rounded text-sm option-btn active" data-target="tweetStyle" data-value="마음요정" onclick="toggleOption(this)">마음요정</button>
                            <button type="button" class="px-3 py-1 border border-gray-300 rounded text-sm option-btn active" data-target="tweetStyle" data-value="인용대화" onclick="toggleOption(this)">인용대화</button>
                        </div>
                        <input type="hidden" id="tweetStyle" value="일상,RT,타장르언급,욕설,우울,R18,폭력성,고어,탐라대화,마음요정,인용대화">
                    </div>
                    
                    <!-- 성향 -->
                    <div class="setting-item">
                        <label class="setting-label">성향</label>
                        <div class="flex flex-wrap gap-2" id="playStyleOptions">
                            <button type="button" class="px-3 py-1 border border-gray-300 rounded text-sm option-btn active" data-target="playStyle" data-value="제작자" onclick="toggleOption(this)">제작자</button>
                            <button type="button" class="px-3 py-1 border border-gray-300 rounded text-sm option-btn active" data-target="playStyle" data-value="소비자" onclick="toggleOption(this)">소비자</button>
                        </div>
                        <input type="hidden" id="playStyle" value="제작자,소비자">
                    </div>
                    
                    <!-- 플랫폼 (텍스트 입력) -->
                    <div class="setting-item">
                        <label class="setting-label">플랫폼</label>
                        <input 
                            type="text" 
                            id="platform" 
                            placeholder="이용 중인 플랫폼을 입력하세요" 
                            class="w-full p-2 border border-gray-300 rounded"
                        >
                    </div>
                    
                    <!-- CP 성향 -->
                    <div class="setting-item">
                        <label class="setting-label">CP 성향</label>
                        <div class="flex flex-wrap gap-2" id="cpPreferenceOptions">
                            <button type="button" class="px-3 py-1 border border-gray-300 rounded text-sm option-btn active" data-target="cpPreference" data-value="HL" onclick="toggleOption(this)">HL</button>
                            <button type="button" class="px-3 py-1 border border-gray-300 rounded text-sm option-btn active" data-target="cpPreference" data-value="BL" onclick="toggleOption(this)">BL</button>
                            <button type="button" class="px-3 py-1 border border-gray-300 rounded text-sm option-btn active" data-target="cpPreference" data-value="GL" onclick="toggleOption(this)">GL</button>
                            <button type="button" class="px-3 py-1 border border-gray-300 rounded text-sm option-btn active" data-target="cpPreference" data-value="ALL" onclick="toggleOption(this)">ALL</button>
                            <button type="button" class="px-3 py-1 border border-gray-300 rounded text-sm option-btn active" data-target="cpPreference" data-value="NCP" onclick="toggleOption(this)">NCP</button>
                            <button type="button" class="px-3 py-1 border border-gray-300 rounded text-sm option-btn active" data-target="cpPreference" data-value="리버시블" onclick="toggleOption(this)">리버시블</button>
                            <button type="button" class="px-3 py-1 border border-gray-300 rounded text-sm option-btn active" data-target="cpPreference" data-value="논리버시블" onclick="toggleOption(this)">논리버시블</button>
                        </div>
                        <input type="hidden" id="cpPreference" value="HL,BL,GL,ALL,NCP,리버시블,논리버시블">
                    </div>
                    
                    <!-- 관계 정리 -->
                    <div class="setting-item">
                        <label class="setting-label">관계 정리</label>
                        <div class="flex flex-wrap gap-2" id="accountStatusOptions">
                            <button 
                                type="button" 
                                class="px-3 py-1 border border-gray-300 rounded text-sm option-btn active" 
                                data-target="accountStatus" 
                                data-value="블락"
                                onclick="toggleOption(this)"
                            >
                                블락
                            </button>
                            <button 
                                type="button" 
                                class="px-3 py-1 border border-gray-300 rounded text-sm option-btn active" 
                                data-target="accountStatus" 
                                data-value="블언블"
                                onclick="toggleOption(this)"
                            >
                                블언블
                            </button>
                            <button 
                                type="button" 
                                class="px-3 py-1 border border-gray-300 rounded text-sm option-btn active" 
                                data-target="accountStatus" 
                                data-value="언팔"
                                onclick="toggleOption(this)"
                            >
                                언팔
                            </button>
                        </div>
                        <input type="hidden" id="accountStatus" value="블락,블언블,언팔">
                    </div>
                    
                    <!-- 지뢰 (텍스트 입력) -->
                    <div class="setting-item">
                        <label class="setting-label">지뢰</label>
                        <input 
                            type="text" 
                            id="sinic" 
                            placeholder="지뢰가 되는 요소를 입력하세요" 
                            class="w-full p-2 border border-gray-300 rounded"
                        >
                    </div>
                    
                    <!-- 지뢰 대응 - 토글 버튼으로 변경 -->
                    <div class="setting-item">
                        <label class="setting-label">지뢰 대응</label>
                        <div class="flex flex-wrap gap-2" id="speechTypeOptions">
                            <button 
                                type="button" 
                                class="px-3 py-1 border border-gray-300 rounded text-sm option-btn active" 
                                data-target="speechType" 
                                data-value="무시가능"
                                onclick="toggleSingleOption(this, 'speechTypeOptions')"
                            >
                                무시가능
                            </button>
                            <button 
                                type="button" 
                                class="px-3 py-1 border border-gray-300 rounded text-sm option-btn" 
                                data-target="speechType" 
                                data-value="직멘제외무시가능"
                                onclick="toggleSingleOption(this, 'speechTypeOptions')"
                            >
                                직멘제외무시가능
                            </button>
                            <button 
                                type="button" 
                                class="px-3 py-1 border border-gray-300 rounded text-sm option-btn" 
                                data-target="speechType" 
                                data-value="무시불가능"
                                onclick="toggleSingleOption(this, 'speechTypeOptions')"
                            >
                                무시불가능
                            </button>
                        </div>
                        <input type="hidden" id="speechType" value="무시가능">
                    </div>
                </div>
            </div>
            
            <!-- 태그 관리 섹션 -->
            <div class="mb-6">
                <h2 class="setting-header">태그 관리</h2>
                
                <div class="flex mb-3">
                    <input 
                        type="text" 
                        id="newTag" 
                        placeholder="새 태그 입력" 
                        class="flex-grow p-2 border border-gray-300 rounded-l"
                    >
                    <button 
                        onclick="addTag()" 
                        class="custom-button px-3 py-2 rounded-r"
                    >
                        추가
                    </button>
                </div>
                
                <div class="flex flex-wrap gap-2 mb-3" id="tagList">
                    <!-- 태그 목록이 여기에 추가됩니다 -->
                </div>
            </div>
            
            <!-- 버튼 영역 -->
            <div class="flex gap-2 mb-4">
                <button 
                    onclick="updatePreview()" 
                    class="flex-1 bg-blue-500 text-white py-2 px-4 rounded"
                >
                    미리보기 업데이트
                </button>
                
                <button 
                    onclick="downloadImage()" 
                    class="flex-1 custom-button py-2 px-4 rounded"
                >
                    이미지로 저장
                </button>
            </div>
            
            <!-- 메시지 영역 -->
            <div id="statusMessage" class="mt-1 p-2 rounded text-center hidden"></div>
        </div>
        
        <!-- 미리보기 패널 -->
        <div class="w-full md:w-2/3 p-4 bg-gray-100 flex justify-center items-start overflow-y-auto">
            <div class="w-full max-w-4xl">
                <h2 class="text-lg font-semibold mb-4">미리보기</h2>
                
                <!-- 가로형 프로필 카드 -->
                <div id="profileCard" class="bg-white rounded-lg shadow-lg overflow-hidden">
                    <!-- 헤더 부분 -->
                    <div class="p-3 text-xl font-bold" id="cardHeader" style="background-color: #F7F4CB; color: #8C6717;">
                        AI Chat 자기소개표
                    </div>

                    <!-- 가로형 프로필 내용 -->
                    <div id="horizontalProfileCard" class="bg-white">
                        <!-- 좌측 프로필 영역 -->
                        <div class="profile-left border-r border-gray-200" id="profileSection">
                            <!-- 배경 이미지 -->
                            <div id="backgroundImageContainer" class="bg-container hidden">
                                <img id="backgroundImage" class="profile-bg" src="" alt="배경 이미지">
                            </div>
                            
                            <!-- 프로필 이미지 및 기본 정보 -->
                            <div class="profile-content flex flex-col items-center">
                                <div id="profileImageContainer" class="w-24 h-24 rounded-full mb-3 flex items-center justify-center text-xs text-gray-400 bg-gray-200">
                                    <span id="profileImagePlaceholder">100 x 100</span>
                                    <img id="profileImage" class="profile-image hidden" src="" alt="프로필 이미지">
                                </div>
                                
                                <div class="text-center">
                                    <div class="font-bold text-gray-700 mb-1" id="profileName">
                                        닉네임 (@아이디)
                                    </div>
                                    <div class="text-sm text-gray-600 mb-3" id="profileBio">
                                        자신을 간단히 소개해주세요.
                                    </div>
                                </div>
                                
                                <!-- 상세 정보 그리드 - 프로필 아래로 이동 -->
                                <div class="w-full mt-2">
                                    <div class="grid grid-cols-1 gap-2">
                                        <!-- 팔로우 안내 - 네모 박스로 통일 -->
                                        <div class="p-2 border border-gray-200 rounded bg-white">
                                            <div class="info-grid">
                                                <div class="text-gray-600 font-medium info-label">팔로우 안내:</div>
                                                <div class="text-gray-800" id="profileFollowGuide">멘션, 마음, RT 하면 팔로우합니다.</div>
                                            </div>
                                        </div>
                                        
                                        <!-- 연령 -->
                                        <div class="p-2 border border-gray-200 rounded bg-white">
                                            <div class="info-grid">
                                                <div class="text-gray-600 font-medium info-label">연령:</div>
                                                <div class="text-gray-800" id="profileAge">성인</div>
                                            </div>
                                        </div>
                                        
                                        <!-- 트윗 성향 -->
                                        <div class="p-2 border border-gray-200 rounded bg-white">
                                            <div class="info-grid">
                                                <div class="text-gray-600 font-medium info-label">트윗 성향:</div>
                                                <div class="text-gray-800" id="profileTweetStyle">일상, RT, 타장르언급, 욕설, 우울, R18, 폭력성, 고어, 탐라대화, 마음요정, 인용대화</div>
                                            </div>
                                        </div>
                                        
                                        <!-- 성향 -->
                                        <div class="p-2 border border-gray-200 rounded bg-white">
                                            <div class="info-grid">
                                                <div class="text-gray-600 font-medium info-label">성향:</div>
                                                <div class="text-gray-800" id="profilePlayStyle">제작자, 소비자</div>
                                            </div>
                                        </div>
                                        
                                        <!-- 플랫폼 -->
                                        <div class="p-2 border border-gray-200 rounded bg-white">
                                            <div class="info-grid">
                                                <div class="text-gray-600 font-medium info-label">플랫폼:</div>
                                                <div class="text-gray-800" id="profilePlatform"></div>
                                            </div>
                                        </div>
                                        
                                        <!-- CP 성향 -->
                                        <div class="p-2 border border-gray-200 rounded bg-white">
                                            <div class="info-grid">
                                                <div class="text-gray-600 font-medium info-label">CP 성향:</div>
                                                <div class="text-gray-800" id="profileCpPreference">HL, BL, GL, ALL, NCP, 리버시블, 논리버시블</div>
                                            </div>
                                        </div>
                                        
                                        <!-- 관계 정리 -->
                                        <div class="p-2 border border-gray-200 rounded bg-white">
                                            <div class="info-grid">
                                                <div class="text-gray-600 font-medium info-label">관계 정리:</div>
                                                <div class="text-gray-800" id="profileAccountStatus">블락, 블언블, 언팔</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 우측 정보 영역 -->
                        <div class="profile-right">
                            <!-- 지뢰 및 지뢰 대응 섹션 -->
                            <div class="w-full mb-4">
                                <div class="mine-response">
                                    <div class="mine-label">지뢰:</div>
                                    <div class="mine-value" id="profileSinic"></div>
                                    <div class="mine-response-value" id="profileSpeechType">무시가능</div>
                                </div>
                            </div>
                            
                            <!-- 태그 섹션 -->
                            <div class="w-full">
                                <div class="text-gray-600 font-medium mb-2">선호 태그:</div>
                                <div class="flex flex-wrap gap-2" id="profileTags">
                                    <!-- 태그 목록이 여기에 추가됩니다 -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
// 상태 관리 객체
const appState = {
    tags: ['남성', '여성', '기타', '인외', '수인', 'HL', 'BL', 'GL', 'NCP', '시뮬레이션', 'R18', '고어', '탑', '바텀', '깁', '텍', '올라운더', '중년', '너드', '쓰레기', '히키코모리', '아이돌', '스포츠', '일상', '빙의', '로맨스', '로판', '판타지', '느와르', 'SF', '아포칼립스', '동양풍', '중세', '현대', '고등학교', '대학교', '마법', '초능력', '히어로', '빌런', '오메가버스', '가이드버스', '네임버스', '하렘', '역하렘', '순애', '짝사랑', '구원', '복수', '강압', '집착', '피폐', '범죄', 'BDSM', 'NTR', '역NTR', '애증', '혐관', '동거', '감금', '키잡', '역키잡', '근친', '짭근친'],
    colors: {
        headerColor: '#F7F4CB',       // 헤더 색상 변경
        headerTextColor: '#8C6717',   // 헤더 텍스트 색상 변경
        tagColor: '#EFDAB1',          // 태그 배경 색상 변경
        tagTextColor: '#8C6717'       // 태그 텍스트 색상 변경
    },
    headerTitle: 'AI Chat 자기소개표',
    textSize: '100',         // 전체 텍스트 크기 (퍼센트)
    headerSize: '100',       // 헤더 제목 크기 (퍼센트)
    nicknameSize: '100'      // 닉네임/아이디 크기 (퍼센트)
};

// 전체 텍스트 크기 업데이트
// 전체 텍스트 크기 업데이트 (CSS 변수 설정 방식)
function updateTextSize(sizePercent) {
    const scaleFactor = parseInt(sizePercent) / 100;
    // profileCard 요소에 CSS 변수 '--text-scale-factor' 설정
    document.getElementById('profileCard').style.setProperty('--text-scale-factor', scaleFactor);
    appState.textSize = sizePercent; // 상태 저장

    // 이 슬라이더와 연동된 다른 크기 조절 함수들도 호출해서
    // 즉시 변경된 --text-scale-factor를 반영하도록 함
    updateHeaderSize(appState.headerSize);
    updateNicknameSize(appState.nicknameSize);
}

// 입력 필드로 텍스트 크기 업데이트 (기존 코드 유지 가능)
function updateTextSizeFromInput(value) {
    let sizePercent = parseInt(value.replace('%', ''));
    if (isNaN(sizePercent)) sizePercent = 100;
    sizePercent = Math.min(130, Math.max(70, sizePercent));
    document.getElementById('textSizeSlider').value = sizePercent;
    document.getElementById('textSizeInput').value = sizePercent + '%';
    updateTextSize(sizePercent); // 수정된 updateTextSize 호출
}

// 헤더 제목 크기 업데이트 (CSS 변수 읽어서 계산)
function updateHeaderSize(sizePercent) {
    // 현재 전체 텍스트 스케일 값 가져오기 (없으면 1)
    const textScale = parseFloat(document.getElementById('profileCard').style.getPropertyValue('--text-scale-factor') || '1');
    const headerScale = parseInt(sizePercent) / 100; // 헤더 자체의 스케일
    const cardHeader = document.getElementById('cardHeader');
    // 기본 헤더 크기(1.25rem)에 전체 스케일과 헤더 스케일을 모두 곱함
    cardHeader.style.fontSize = `calc(${textScale} * ${headerScale} * 1.25rem)`;
    appState.headerSize = sizePercent; // 상태 저장
}

// 입력 필드로 헤더 크기 업데이트 (기존 코드 유지 가능)
function updateHeaderSizeFromInput(value) {
    let sizePercent = parseInt(value.replace('%', ''));
    if (isNaN(sizePercent)) sizePercent = 100;
    sizePercent = Math.min(150, Math.max(70, sizePercent));
    document.getElementById('headerSizeSlider').value = sizePercent;
    document.getElementById('headerSizeInput').value = sizePercent + '%';
    updateHeaderSize(sizePercent); // 수정된 updateHeaderSize 호출
}

// 닉네임/아이디 크기 업데이트 (CSS 변수 읽어서 계산)
function updateNicknameSize(sizePercent) {
    // 현재 전체 텍스트 스케일 값 가져오기 (없으면 1)
    const textScale = parseFloat(document.getElementById('profileCard').style.getPropertyValue('--text-scale-factor') || '1');
    const nicknameScale = parseInt(sizePercent) / 100; // 닉네임 자체의 스케일
    const profileName = document.getElementById('profileName');
    // 기본 닉네임 크기(예: 1.1rem)에 전체 스케일과 닉네임 스케일을 모두 곱함
    profileName.style.fontSize = `calc(${textScale} * ${nicknameScale} * 1.1rem)`; // (기본 크기 1.1rem은 원래 스타일에 맞게 조절 필요)
    profileName.style.fontWeight = 'bold'; // 볼드 유지
    appState.nicknameSize = sizePercent; // 상태 저장
}

// 입력 필드로 닉네임 크기 업데이트 (기존 코드 유지 가능)
function updateNicknameSizeFromInput(value) {
    let sizePercent = parseInt(value.replace('%', ''));
    if (isNaN(sizePercent)) sizePercent = 100;
    sizePercent = Math.min(150, Math.max(70, sizePercent));
    document.getElementById('nicknameSizeSlider').value = sizePercent;
    document.getElementById('nicknameSizeInput').value = sizePercent + '%';
    updateNicknameSize(sizePercent); // 수정된 updateNicknameSize 호출
}
// 닉네임/아이디 크기 업데이트
function updateNicknameSize(sizePercent) {
    const size = parseInt(sizePercent) / 100;
    
    // 닉네임/아이디에 크기 적용
    const profileName = document.getElementById('profileName');
    // 기본 텍스트 크기(1rem)에 비례하여 조정
    profileName.style.fontSize = `${1.1 * size}rem`;
    profileName.style.fontWeight = 'bold';
    
    // 현재 닉네임 크기를 appState에 저장
    appState.nicknameSize = sizePercent;
}

// 입력 필드로 닉네임 크기 업데이트
function updateNicknameSizeFromInput(value) {
    // '%' 기호 제거하고 숫자만 추출
    let sizePercent = parseInt(value.replace('%', ''));
    
    // 범위 제한 (70% ~ 150%)
    if (isNaN(sizePercent)) sizePercent = 100;
    sizePercent = Math.min(150, Math.max(70, sizePercent));
    
    // 슬라이더 값 업데이트
    document.getElementById('nicknameSizeSlider').value = sizePercent;
    
    // 입력 필드 값 형식화
    document.getElementById('nicknameSizeInput').value = sizePercent + '%';
    
    // 닉네임 크기 적용
    updateNicknameSize(sizePercent);
}
// 페이지 로드 시 초기화
document.addEventListener('DOMContentLoaded', function() {
    initColorPickers();
    renderTags();
    
    // 텍스트 크기 초기화 (페이지 로드 시)
    updateTextSize(appState.textSize);
    updateHeaderSize(appState.headerSize);
    updateNicknameSize(appState.nicknameSize);
    

    // 프로필 및 배경 이미지 URL 설정 후 자동 로드
    document.getElementById('profileImageUrl').value = "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSkGHVkHhOalIBxWeuKVuV-8T4hGPXVBIgTNw&s";
    document.getElementById('backgroundImageUrl').value = "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSkGHVkHhOalIBxWeuKVuV-8T4hGPXVBIgTNw&s";
    
    // 이미지 업데이트 함수 호출
    updateProfileImage();
    updateBackgroundImage();
    
    // 엔터키 이벤트
    document.getElementById('newTag').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') addTag();
    });
    
    // 색상 선택기 이벤트
    document.getElementById('headerColor').addEventListener('input', function() {
        const headerColor = this.value;
        appState.colors.headerColor = headerColor;
        
        // 헤더 배경색 적용
        document.getElementById('cardHeader').style.backgroundColor = headerColor;
        
        // 토글 버튼 활성화 배경색 업데이트
        updateToggleButtonStyles();
        
        // 태그 목록 배경색 업데이트 (설정 패널에만)
        updateSettingTagStyles();
    });
    
    document.getElementById('headerTextColor').addEventListener('input', function() {
        appState.colors.headerTextColor = this.value;
        document.getElementById('cardHeader').style.color = this.value;
    });
    
    document.getElementById('tagColor').addEventListener('input', function() {
        appState.colors.tagColor = this.value;
        renderTags();
    });
    
    document.getElementById('tagTextColor').addEventListener('input', function() {
        const tagTextColor = this.value;
        appState.colors.tagTextColor = tagTextColor;
        
        // 토글 버튼 텍스트 색상 업데이트
        updateToggleButtonStyles();
        
        // 태그 렌더링 갱신 (미리보기 태그 스타일 변경)
        renderTags();
    });
    
    // 배경 투명도
    document.getElementById('backgroundOpacity').addEventListener('input', function() {
        const backgroundImage = document.getElementById('backgroundImage');
        if (backgroundImage) {
            backgroundImage.style.opacity = this.value / 100;
        }
    });
    
    // 초기 스타일 적용
    updateToggleButtonStyles();
    
    // 미리보기 초기 업데이트 (기본값 표시)
    updatePreview();
});

// 단일 선택 옵션 토글 (연령, 지뢰 대응처럼 하나만 선택 가능한 경우)
function toggleSingleOption(button, groupId) {
    const target = button.dataset.target;
    const value = button.dataset.value;
    const hiddenInput = document.getElementById(target);
    const group = document.getElementById(groupId);
    
    // 그룹 내 모든 버튼 비활성화
    group.querySelectorAll('.option-btn').forEach(btn => {
        btn.classList.remove('active');
        btn.style.backgroundColor = '';
        btn.style.color = '';
        btn.style.borderColor = '';
    });
    
    // 선택한 버튼만 활성화
    button.classList.add('active');
    button.style.backgroundColor = appState.colors.headerColor;
    button.style.color = appState.colors.tagTextColor;
    button.style.borderColor = appState.colors.headerColor;
    
    // 값 업데이트
    hiddenInput.value = value;
    
    // 미리보기 업데이트
    document.getElementById(`profile${target.charAt(0).toUpperCase() + target.slice(1)}`).textContent = value;
}

// 토글 버튼 스타일 업데이트 함수
function updateToggleButtonStyles() {
    const headerColor = appState.colors.headerColor;
    const tagTextColor = appState.colors.tagTextColor;
    
    // 모든 활성화된 토글 버튼의 스타일 변경
    document.querySelectorAll('.option-btn.active').forEach(button => {
        button.style.backgroundColor = headerColor;
        button.style.color = tagTextColor;
        button.style.borderColor = headerColor;
    });
    
    // 스타일 규칙 업데이트(동적 CSS 추가)
    updateCSSRule('.option-btn.active', `
        background-color: ${headerColor} !important;
        color: ${tagTextColor} !important;
        border-color: ${headerColor} !important;
    `);
}

// 설정 패널의 태그 스타일 업데이트
function updateSettingTagStyles() {
    const headerColor = appState.colors.headerColor;
    const tagTextColor = appState.colors.tagTextColor;
    
    // 설정 패널의 태그 배경색 변경
    document.querySelectorAll('#tagList .flex.items-center').forEach(tag => {
        tag.style.backgroundColor = headerColor;
        tag.style.color = tagTextColor;
    });
}

// 동적 CSS 규칙 추가/업데이트 함수
function updateCSSRule(selector, cssText) {
    // 기존 스타일 요소 찾기 또는 새로 생성
    let styleEl = document.getElementById('dynamic-styles');
    if (!styleEl) {
        styleEl = document.createElement('style');
        styleEl.id = 'dynamic-styles';
        document.head.appendChild(styleEl);
    }
    
    // 기존 규칙 찾기
    const sheet = styleEl.sheet;
    for (let i = 0; sheet.cssRules && i < sheet.cssRules.length; i++) {
        if (sheet.cssRules[i].selectorText === selector) {
            sheet.deleteRule(i);
            break;
        }
    }
    
    // 새 규칙 추가
    try {
        sheet.insertRule(`${selector} { ${cssText} }`, sheet.cssRules ? sheet.cssRules.length : 0);
    } catch (e) {
        console.error('CSS 규칙 추가 실패:', e);
    }
}

// 옵션 토글 함수 (여러 선택 가능)
function toggleOption(button) {
    const target = button.dataset.target;
    const value = button.dataset.value;
    const hiddenInput = document.getElementById(target);
    
    // 현재 선택된 값들을 배열로 변환
    let values = hiddenInput.value ? hiddenInput.value.split(',').map(v => v.trim()) : [];
    
    // 값이 이미 있으면 제거, 없으면 추가
    if (button.classList.contains('active')) {
        // 값 제거
        values = values.filter(v => v !== value);
        button.classList.remove('active');
        // 스타일 제거
        button.style.backgroundColor = '';
        button.style.color = '';
        button.style.borderColor = '';
    } else {
        // 값 추가
        values.push(value);
        button.classList.add('active');
        // 활성화 스타일 즉시 적용
        button.style.backgroundColor = appState.colors.headerColor;
        button.style.color = appState.colors.tagTextColor;
        button.style.borderColor = appState.colors.headerColor;
    }
    
    // 업데이트된 값 저장 - 쉼표와 공백으로 구분
    hiddenInput.value = values.length > 0 ? values.join(', ') : '';
    
    // 팔로우 안내 특별 처리
    if (target === 'followType') {
        updateFollowGuide(values);
    }
}

// 팔로우 안내 텍스트 업데이트
function updateFollowGuide(values) {
    let followText = '';
    if (values && values.length > 0) {
        followText = values.join(', ') + ' 하면 팔로우합니다.';
    } else {
        followText = '하면 팔로우합니다.';
    }
    document.getElementById('profileFollowGuide').textContent = followText;
}

// 섹션 토글
function toggleSection(sectionId) {
    const section = document.getElementById(sectionId);
    const toggleIcon = document.getElementById(sectionId.replace('Section', 'ToggleIcon'));
    
    if (section.classList.contains('hidden')) {
        section.classList.remove('hidden');
        toggleIcon.classList.add('rotate-180');
    } else {
        section.classList.add('hidden');
        toggleIcon.classList.remove('rotate-180');
    }
}

// 색상 선택기 초기화
function initColorPickers() {
    document.getElementById('headerColor').value = appState.colors.headerColor;
    document.getElementById('headerTextColor').value = appState.colors.headerTextColor;
    document.getElementById('tagColor').value = appState.colors.tagColor;
    document.getElementById('tagTextColor').value = appState.colors.tagTextColor;
    
    document.getElementById('cardHeader').style.backgroundColor = appState.colors.headerColor;
    document.getElementById('cardHeader').style.color = appState.colors.headerTextColor;
}

// 헤더 제목 업데이트
function updateHeaderTitle(title) {
    appState.headerTitle = title;
    document.getElementById('cardHeader').textContent = title;
}

// 헤더 텍스트 색상 업데이트
function updateHeaderTextColor(color) {
    appState.colors.headerTextColor = color;
    document.getElementById('cardHeader').style.color = color;
}

// 태그 추가
function addTag() {
    const newTagInput = document.getElementById('newTag');
    const tagValue = newTagInput.value.trim();
    
    if (tagValue === '') {
        showStatusMessage('태그를 입력해주세요.', 'red');
        return;
    }
    
    if (appState.tags.includes(tagValue)) {
        showStatusMessage('이미 존재하는 태그입니다.', 'red');
        return;
    }
    
    appState.tags.push(tagValue);
    newTagInput.value = '';
    renderTags();
    showStatusMessage('태그가 추가되었습니다.', 'green');
}

// 태그 삭제
function removeTag(tagValue) {
    appState.tags = appState.tags.filter(tag => tag !== tagValue);
    renderTags();
    showStatusMessage('태그가 삭제되었습니다.', 'blue');
}

// 태그 렌더링
function renderTags() {
    const tagList = document.getElementById('tagList');
    const profileTags = document.getElementById('profileTags');
    
    tagList.innerHTML = '';
    profileTags.innerHTML = '';
    
    const tagBgColor = appState.colors.tagColor;
    const tagTextColor = appState.colors.tagTextColor;
    const headerColor = appState.colors.headerColor; // 헤더 색상 가져오기
    
    appState.tags.forEach(tag => {
        // 설정 패널의 태그 목록 - 헤더 색상 적용
        const tagElement = document.createElement('div');
        tagElement.className = 'flex items-center px-3 py-1 rounded';
        tagElement.style.backgroundColor = headerColor; // 헤더 색상을 배경색으로 사용
        tagElement.style.color = tagTextColor; // 태그 텍스트 색상 적용
        tagElement.innerHTML = `
            <span class="mr-2">${tag}</span>
            <button 
                class="text-red-500 hover:text-red-700" 
                onclick="removeTag('${tag}')"
            >×</button>
        `;
        tagList.appendChild(tagElement);
        
        // 미리보기 태그 - 태그 배경 색상 사용
        const previewTagElement = document.createElement('span');
        previewTagElement.className = 'tag-item';
        previewTagElement.textContent = tag;
        previewTagElement.style.backgroundColor = tagBgColor;
        previewTagElement.style.color = tagTextColor;
        
        profileTags.appendChild(previewTagElement);
    });
    
    // 설정 패널의 태그 목록 스타일 갱신
    updateSettingTagStyles();
}

// 프로필 이미지 업데이트
function updateProfileImage() {
    const imageUrl = document.getElementById('profileImageUrl').value.trim();
    const profileImage = document.getElementById('profileImage');
    const profileImagePlaceholder = document.getElementById('profileImagePlaceholder');
    
    if (imageUrl !== '') {
        profileImage.src = imageUrl;
        profileImage.classList.remove('hidden');
        profileImagePlaceholder.classList.add('hidden');
        
        profileImage.onerror = function() {
            profileImage.classList.add('hidden');
            profileImagePlaceholder.classList.remove('hidden');
            showStatusMessage('이미지를 불러올 수 없습니다.', 'red');
        };
    } else {
        profileImage.classList.add('hidden');
        profileImagePlaceholder.classList.remove('hidden');
    }
}

// 배경 이미지 업데이트
function updateBackgroundImage() {
    const imageUrl = document.getElementById('backgroundImageUrl').value.trim();
    const opacity = document.getElementById('backgroundOpacity').value;
    const backgroundImageContainer = document.getElementById('backgroundImageContainer');
    const backgroundImage = document.getElementById('backgroundImage');
    const profileSection = document.getElementById('profileSection');
    
    if (imageUrl !== '') {
        backgroundImage.src = imageUrl;
        backgroundImageContainer.classList.remove('hidden');
        backgroundImage.style.opacity = opacity / 100;
        profileSection.classList.add('has-bg-image');
        
        backgroundImage.onerror = function() {
            backgroundImageContainer.classList.add('hidden');
            profileSection.classList.remove('has-bg-image');
            showStatusMessage('배경 이미지를 불러올 수 없습니다.', 'red');
        };
    } else {
        backgroundImageContainer.classList.add('hidden');
        profileSection.classList.remove('has-bg-image');
    }
}

// 미리보기 업데이트
function updatePreview() {
    // 헤더 제목 업데이트
    updateHeaderTitle(document.getElementById('headerTitle').value);
    
    // 이미지 업데이트
    updateProfileImage();
    updateBackgroundImage();
    
    // 프로필 정보 업데이트
    const fields = [
        { inputId: 'nickname', outputId: 'profileName', defaultText: '닉네임 (@아이디)' },
        { inputId: 'bio', outputId: 'profileBio', defaultText: '자신을 간단히 소개해주세요.' },
        { inputId: 'age', outputId: 'profileAge', defaultText: '성인' },
        { inputId: 'accountStatus', outputId: 'profileAccountStatus' },
        { inputId: 'sinic', outputId: 'profileSinic' },
        { inputId: 'speechType', outputId: 'profileSpeechType' },
        { inputId: 'tweetStyle', outputId: 'profileTweetStyle' },
        { inputId: 'playStyle', outputId: 'profilePlayStyle' },
        { inputId: 'platform', outputId: 'profilePlatform' },
        { inputId: 'cpPreference', outputId: 'profileCpPreference' }
    ];
    
    fields.forEach(field => {
        const value = document.getElementById(field.inputId).value;
        const outputElement = document.getElementById(field.outputId);
        if (outputElement) {
            outputElement.textContent = value || field.defaultText || '';
        }
    });
    
    // 팔로우 안내 특별 처리
    const followTypeValue = document.getElementById('followType').value;
    const followValues = followTypeValue ? followTypeValue.split(',').map(item => item.trim()) : [];
    updateFollowGuide(followValues);
    
    // 태그 업데이트
    renderTags();
    
    // 토글 버튼 스타일 업데이트
    updateToggleButtonStyles();
    
    showStatusMessage('미리보기가 업데이트되었습니다!', 'blue');
}

// dom-to-image 라이브러리를 사용한 이미지 저장 함수
function downloadImage() {
    const profileCard = document.getElementById('profileCard');
    showStatusMessage("이미지 생성 중...", 'green');
    
    // dom-to-image 설정
    const options = {
        quality: 1.0,
        bgcolor: '#fff',
        style: {
          'font-smooth': 'always',
          'text-rendering': 'optimizeLegibility'
        },
        filter: (node) => {
            // 숨겨진 요소 제외
            return !node.classList || !node.classList.contains('hidden');
        }
    };
    
    // PNG 이미지 생성
    domtoimage.toPng(profileCard, options)
        .then(function(dataUrl) {
            // 다운로드 링크 생성
            const link = document.createElement('a');
            link.download = '자기소개표.png';
            link.href = dataUrl;
            link.click();
            
            showStatusMessage("이미지로 저장되었습니다!", 'green');
        })
        .catch(function(error) {
            console.error('이미지 생성 중 오류:', error);
            
            // 오류 발생 시 대체 방법 시도
            showStatusMessage("첫 번째 방법 실패, 대체 방법 시도 중...", 'blue');
            
            // 대체 방법: JPEG 형식으로 시도
            domtoimage.toJpeg(profileCard, { 
                quality: 0.95,
                bgcolor: '#ffffff'
            })
            .then(function(dataUrl) {
                const link = document.createElement('a');
                link.download = '자기소개표.jpg';
                link.href = dataUrl;
                link.click();
                
                showStatusMessage("JPEG 형식으로 저장되었습니다!", 'green');
            })
            .catch(function(finalError) {
                console.error('최종 이미지 생성 실패:', finalError);
                showStatusMessage("이미지 생성에 실패했습니다.", 'red');
            });
        });
}

// 상태 메시지 표시
function showStatusMessage(message, color) {
    const statusMessage = document.getElementById('statusMessage');
    
    let bgClass, textClass;
    switch(color) {
        case 'blue': bgClass = 'bg-blue-100'; textClass = 'text-blue-800'; break;
        case 'green': bgClass = 'bg-green-100'; textClass = 'text-green-800'; break;
        case 'red': bgClass = 'bg-red-100'; textClass = 'text-red-800'; break;
        default: bgClass = 'bg-gray-100'; textClass = 'text-gray-800';
    }
    
    statusMessage.className = `mt-1 p-2 rounded text-center ${bgClass} ${textClass}`;
    statusMessage.textContent = message;
    statusMessage.classList.remove('hidden');
    
    setTimeout(() => {
        statusMessage.classList.add('hidden');
    }, 3000);
}
    </script>
</body>
</html>